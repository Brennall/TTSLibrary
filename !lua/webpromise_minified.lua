API=function(a,b)local c=a or""local d=b or{}local e=function(f)f:gsub("([^A-Za-z0-9%_%.%-%~])",function(g)return string.upper(string.format("%%%02x",string.byte(g)))end)f:gsub('%%20','+')return f end;local querify=function(h,i,j)i=i or"&"local k={}local l={}for m in pairs(h)do l[#l+1]=m end;table.sort(l)for n,o in ipairs(l)do local p=h[o]o=e(tostring(o))if j then o=string.format('%s[%s]',tostring(j),tostring(o))end;if type(p)=='table'then k[#k+1]=querify(p,i,o)else local p=e(tostring(p))if p~=""then k[#k+1]=string.format('%s=%s',o,p)else k[#k+1]=o end end end;return table.concat(k,i)end;local q=function(r,s,t,u)local v=r;local w=s;local x=t or{}local y=u or{}local z=function(A)log(A)end;local B=function(A)log(A)end;local C=function(A)log(A)end;local D={}local _keep=function(E)if not E.is_done then return _keep(E)end;if E.is_error then return C(E.error)end;jRes=JSON.decode(E.text)if jRes.errors~=nil then return B(jRes.errors)end;return z(jRes.result or jRes or{})end;D["param"]=function(j,p)x[j]=p;return D end;D["resolve"]=function(F)z=F;return D end;D["catch"]=function(F)B=F;return D end;D["fault"]=function(F)C=F;return D end;D["dispatch"]=function()if v=="get"then for m,g in pairs(d)do x[m]=g end;local G=c..w.."?"..querify(x)WebRequest.get(G,_keep)elseif v=="post"then for m,g in pairs(d)do x[m]=g end;local G=c..w.."?"..querify(x)WebRequest.post(G,y,_keep)end;return D end;return D end;local H={}H["get"]=function(s,t)return q("get",s,t or{})end;H["post"]=function(s,u,t)return q("post",s,t or{},u or{})end;H["base"]=function(s)c=s;return H end;H["defparam"]=function(j,p)d[j]=p;return H end;return H end