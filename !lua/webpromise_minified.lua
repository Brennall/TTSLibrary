API=(function()local a=function(b)b:gsub("([^A-Za-z0-9%_%.%-%~])",function(c)return string.upper(string.format("%%%02x",string.byte(c)))end)b:gsub('%%20','+')return b end;local querify=function(d,e,f)e=e or"&"local g={}local h={}for i in pairs(d)do h[#h+1]=i end;table.sort(h)for j,k in ipairs(h)do local l=d[k]k=a(tostring(k))if f then k=string.format('%s[%s]',tostring(f),tostring(k))end;if type(l)=='table'then g[#g+1]=querify(l,e,k)else local l=a(tostring(l))if l~=""then g[#g+1]=string.format('%s=%s',k,l)else g[#g+1]=k end end end;return table.concat(g,e)end;local m=function(n,o,p,q)local r=n;local s=o;local t=p or{}local u=q or{}local v=function(w)log(w)end;local x=function(w)log(w)end;local y=function(w)log(w)end;local z={}local _keep=function(A)if not A.is_done then return _keep(A)end;if A.is_error then return y(A.error)end;if A.text.errors~=nil then return x(A.text.errors)end;return v(A.text.result or A.text or{})end;z["try"]=function(B)v=B;return z end;z["catch"]=function(B)x=B;return z end;z["fault"]=function(B)y=B;return z end;z["resolve"]=function()if r=="get"then local C=s.."?"..querify(t)WebRequest.get(C,_keep)elseif r=="post"then local C=s.."?"..querify(t)WebRequest.post(C,u,_keep)end end;return z end;local D={["get"]=function(o,p)return m("get",o,p or{})end,["post"]=function(o,q,p)return m("post",o,p or{},q or{})end}return D end)()
